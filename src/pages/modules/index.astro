---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Section from '../../components/Section.astro';
import ModuleCard from '../../components/ModuleCard.astro';
import CTA from '../../components/CTA.astro';
import { modules } from '../../data/modules';
import { pricingInfo } from '../../data/pricing';

// Pr√©parer les donn√©es pour le tableau r√©capitulatif des dates
const niveauLabels: Record<1 | 2 | 3, string> = {
  1: 'D√©butant',
  2: 'Interm√©diaire',
  3: 'Avanc√©',
};

const allDates: Array<{
  date: string;
  week: string;
  course: string;
  day: string;
  slug: string;
  comingSoon: boolean;
  almostFull: boolean;
}> = [];

modules.forEach((module) => {
  const niveauLabel = niveauLabels[module.niveau];
  // Afficher le niveau seulement pour les modules de th√©orie (qui ont plusieurs niveaux)
  // Pour les modules pratiques, on affiche juste le titre
  const isTheoryModule = module.title.includes('Th√©orie');
  const courseLabel = isTheoryModule 
    ? `${module.title} (${niveauLabel})`
    : module.title;
  
  module.dates.forEach((date) => {
    allDates.push({
      date,
      week: module.schedule.week,
      course: courseLabel,
      day: module.schedule.day,
      slug: module.slug,
      comingSoon: module.comingSoon || false,
      almostFull: module.almostFull || false,
    });
  });
});

// Trier par date (approximation simple pour l'affichage)
const monthOrder: Record<string, number> = {
  'janvier': 1,
  'f√©vrier': 2,
  'mars': 3,
  'avril': 4,
  'mai': 5,
};

allDates.sort((a, b) => {
  const aMonth = Object.keys(monthOrder).find(m => a.date.includes(m)) || '';
  const bMonth = Object.keys(monthOrder).find(m => b.date.includes(m)) || '';
  const aMonthNum = monthOrder[aMonth] || 0;
  const bMonthNum = monthOrder[bMonth] || 0;
  
  if (aMonthNum !== bMonthNum) {
    return aMonthNum - bMonthNum;
  }
  
  // Si m√™me mois, trier par jour
  const aDay = parseInt(a.date.match(/^\d+/)?.[0] || '0');
  const bDay = parseInt(b.date.match(/^\d+/)?.[0] || '0');
  return aDay - bDay;
});
---

<BaseLayout
  title="Les modules | CDMC"
  description="D√©couvre tous les modules CDMC : Th√©orie D√©butant, Th√©orie Interm√©diaire, Th√©orie Avanc√©e, MAO, Piano, Rythmique. Cours de musique √† Toulouse pour d√©butant¬∑es et interm√©diaires."
>
  <Section id="modules-list" title="Les modules CDMC">
    <p class="text-lg text-warm-700 dark:text-warm-200 mb-8 max-w-3xl mx-auto text-center">
      Six modules pour explorer la musique sous diff√©rents angles. 
      Choisis celui ou ceux qui te correspondent, ou combine-les pour une approche compl√®te.
    </p>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {modules
        .sort((a, b) => (a.comingSoon ? 1 : 0) - (b.comingSoon ? 1 : 0))
        .map((module) => (
          <ModuleCard module={module} />
        ))}
    </div>
  </Section>

  <!-- Rythme et dur√©e -->
  <Section id="rythme" title="Rythme et dur√©e" className="bg-warm-50 dark:bg-warm-900">
    <div class="max-w-3xl mx-auto space-y-6">
      <div class="bg-warm-100 dark:bg-warm-800 rounded-lg p-6 space-y-4">
        <div>
          <h3 class="text-xl font-semibold text-warm-800 dark:text-warm-100 mb-3">
            Format des s√©ances
          </h3>
          <ul class="space-y-2 text-warm-700 dark:text-warm-200">
            <li class="flex items-start">
              <span class="text-terracotta-600 dark:text-terracotta-400 mr-2">‚Ä¢</span>
              <span><strong>Une s√©ance par mois</strong>, de <strong>2h30</strong></span>
            </li>
            <li class="flex items-start">
              <span class="text-terracotta-600 mr-2">‚Ä¢</span>
              <span>Cycle de <strong>5 mois</strong> (janvier √† mai 2026)</span>
            </li>
            <li class="flex items-start">
              <span class="text-terracotta-600 mr-2">‚Ä¢</span>
              <span>Entre <strong>4 et 9 participant¬∑es</strong> par module pour une ambiance intime</span>
            </li>
          </ul>
        </div>

        <div class="border-t border-warm-200 dark:border-warm-700 pt-4">
          <h3 class="text-xl font-semibold text-warm-800 dark:text-warm-100 mb-3">
            Rejoindre le groupe
          </h3>
          <p class="text-warm-700 dark:text-warm-200">
            Un groupe est constitu√© d√®s le d√©but du cycle (janvier √† mai 2026), et une fois lanc√©¬∑e, 
            c'est bien de rester sur la suite pour une progression continue. 
            <strong>Tu peux aussi rejoindre en cours de route sans souci</strong> ‚Äì on s'adapte √† ta situation 
            et on te remet √† niveau si besoin. Chaque s√©ance est importante dans le parcours d'apprentissage.
          </p>
        </div>
      </div>
    </div>
  </Section>

  <!-- Organisation mensuelle -->
  <Section id="organisation-mensuelle" title="Organisation mensuelle">
    <div class="max-w-3xl mx-auto space-y-6">
      <div>
        <p class="text-lg text-warm-700 dark:text-warm-200 mb-6">
          Les s√©ances ont lieu dans <strong>les deux derni√®res semaines de chaque mois</strong>, 
          organis√©es en deux types de semaines distinctes :
        </p>

        <div class="bg-white dark:bg-warm-800 rounded-lg shadow-md p-6 border border-warm-200 dark:border-warm-700 space-y-6 mb-6">
          <div>
            <h3 class="text-xl font-semibold text-warm-800 dark:text-warm-100 mb-3">
              Semaine Th√©orie (avant-derni√®re semaine du mois)
            </h3>
            <p class="text-warm-700 dark:text-warm-200 mb-3">
              Cette semaine est d√©di√©e aux modules th√©oriques. Trois modules sont propos√©s :
            </p>
            <ul class="space-y-2 text-warm-700 dark:text-warm-200 ml-4">
              <li>‚Ä¢ <strong>Mardi</strong> : Th√©orie D√©butant</li>
              <li>‚Ä¢ <strong>Mercredi</strong> : Th√©orie Interm√©diaire</li>
              <li>‚Ä¢ <strong>Jeudi</strong> : Th√©orie Avanc√©e</li>
            </ul>
            <p class="text-warm-600 dark:text-warm-300 text-sm mt-3 italic">
              Ces modules permettent de comprendre les fondements de la musique, les accords, 
              les fonctions harmoniques, et d'approfondir ta compr√©hension th√©orique.
            </p>
          </div>

          <div class="border-t border-warm-200 dark:border-warm-700 pt-6">
            <h3 class="text-xl font-semibold text-warm-800 dark:text-warm-100 mb-3">
              Semaine Pratique (derni√®re semaine du mois)
            </h3>
            <p class="text-warm-700 dark:text-warm-200 mb-3">
              Cette semaine est d√©di√©e aux modules pratiques. Trois modules sont propos√©s :
            </p>
            <ul class="space-y-2 text-warm-700 dark:text-warm-200 ml-4">
              <li>‚Ä¢ <strong>Mardi</strong> : Piano</li>
              <li>‚Ä¢ <strong>Mercredi</strong> : MAO (Musique Assist√©e par Ordinateur)</li>
              <li>‚Ä¢ <strong>Jeudi</strong> : Rythmique</li>
            </ul>
            <p class="text-warm-600 dark:text-warm-300 text-sm mt-3 italic">
              Ces modules permettent de mettre en pratique ce que tu apprends, de jouer, 
              de cr√©er et de d√©velopper tes comp√©tences techniques.
            </p>
          </div>
        </div>

        <div class="bg-warm-100 dark:bg-warm-800 rounded-lg p-6 border-l-4 border-terracotta-500 dark:border-terracotta-400">
          <p class="text-warm-800 dark:text-warm-100 font-medium mb-2">
            üí° Pourquoi cette organisation ?
          </p>
          <p class="text-warm-700 dark:text-warm-200 text-sm">
            Cette d√©coupe permet de s√©parer clairement la th√©orie et la pratique, 
            tout en offrant une flexibilit√© pour combiner plusieurs modules selon tes envies et tes besoins. 
            Tu peux suivre uniquement des modules th√©oriques, uniquement des modules pratiques, 
            ou combiner les deux pour une approche compl√®te.
          </p>
        </div>
      </div>
    </div>
  </Section>

  <!-- Tableau r√©capitulatif des dates -->
  <Section id="dates-recap" title="Vue d'ensemble des dates" className="bg-warm-50 dark:bg-warm-900">
    <div class="max-w-4xl mx-auto space-y-6">
      <div>
        <p class="text-lg text-warm-700 dark:text-warm-200 mb-6">
          Voici le planning complet de toutes les s√©ances pour le cycle de janvier √† mai 2026. 
          Les dates sont organis√©es chronologiquement pour te donner une vue d'ensemble.
        </p>

        <div class="overflow-x-auto">
          <table class="w-full border-collapse bg-white dark:bg-warm-800 rounded-lg shadow-md">
            <thead>
              <tr class="bg-warm-200 dark:bg-warm-700">
                <th class="border border-warm-300 dark:border-warm-600 px-4 py-3 text-left font-semibold text-warm-800 dark:text-warm-100">
                  Semaine
                </th>
                <th class="border border-warm-300 dark:border-warm-600 px-4 py-3 text-left font-semibold text-warm-800 dark:text-warm-100">
                  Jour
                </th>
                <th class="border border-warm-300 dark:border-warm-600 px-4 py-3 text-left font-semibold text-warm-800 dark:text-warm-100">
                  Cours et niveau
                </th>
                <th class="border border-warm-300 dark:border-warm-600 px-4 py-3 text-left font-semibold text-warm-800 dark:text-warm-100">
                  Date
                </th>
              </tr>
            </thead>
            <tbody>
              {allDates.map((item, index) => (
                <tr class={`${index % 2 === 0 ? 'bg-white dark:bg-warm-800' : 'bg-warm-50 dark:bg-warm-700'} ${item.comingSoon ? 'opacity-60' : ''}`}>
                  <td class="border border-warm-300 dark:border-warm-600 px-4 py-3 text-warm-700 dark:text-warm-200">
                    <span class="font-medium">{item.week}</span>
                  </td>
                  <td class="border border-warm-300 dark:border-warm-600 px-4 py-3 text-warm-700 dark:text-warm-200">
                    {item.day}
                  </td>
                  <td class="border border-warm-300 dark:border-warm-600 px-4 py-3 text-warm-700 dark:text-warm-200">
                    <div class="flex items-center gap-2">
                      <a href={`/modules/${item.slug}`} class={`underline font-medium ${
                        item.comingSoon 
                          ? 'text-warm-400 dark:text-warm-500 hover:text-warm-500 dark:hover:text-warm-400' 
                          : 'text-terracotta-600 dark:text-terracotta-400 hover:text-terracotta-700 dark:hover:text-terracotta-300'
                      }`}>
                        {item.course}
                      </a>
                      {item.comingSoon && (
                        <span class="px-2 py-0.5 text-xs font-medium bg-warm-200 dark:bg-warm-700 text-warm-600 dark:text-warm-300 rounded">
                          Prochainement
                        </span>
                      )}
                      {item.almostFull && (
                        <span class="px-2 py-0.5 text-xs font-medium bg-terracotta-100 dark:bg-terracotta-900 text-terracotta-700 dark:text-terracotta-300 rounded">
                          Bient√¥t complet
                        </span>
                      )}
                    </div>
                  </td>
                  <td class="border border-warm-300 dark:border-warm-600 px-4 py-3 text-warm-700 dark:text-warm-200 font-medium">
                    {item.date} 2026
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>

        <div class="bg-warm-100 dark:bg-warm-800 rounded-lg p-6 mt-6">
          <p class="text-warm-800 dark:text-warm-100 font-medium mb-2">
            üìÖ Note importante
          </p>
          <p class="text-warm-700 dark:text-warm-200 text-sm">
            Toutes les s√©ances durent <strong>2h30</strong>. Les dates peuvent √™tre ajust√©es en cas de n√©cessit√©, 
            mais le planning g√©n√©ral reste stable sur les deux derni√®res semaines de chaque mois. 
            Si tu as des questions sur une date sp√©cifique, n'h√©site pas √† me contacter.
          </p>
        </div>
      </div>
    </div>
  </Section>

  <!-- Lieu -->
  <Section id="lieu" title="Lieu">
    <div class="max-w-3xl mx-auto">
      <div class="bg-white dark:bg-warm-800 rounded-lg shadow-md p-6 border border-warm-200 dark:border-warm-700">
        <p class="text-warm-700 dark:text-warm-200 mb-4">
          Les cours se d√©roulent dans un <strong>grand salon am√©nag√©</strong>, √† Toulouse. 
          La capacit√© varie selon les modules (de 2 √† 9 participant¬∑es) pour garantir une ambiance intime 
          et un suivi personnalis√©.
        </p>
        <p class="text-warm-700 dark:text-warm-200">
          <strong>Lieu :</strong> {pricingInfo.location}
        </p>
      </div>
    </div>
  </Section>
</BaseLayout>

