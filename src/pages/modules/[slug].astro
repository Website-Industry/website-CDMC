---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Section from '../../components/Section.astro';
import CTA from '../../components/CTA.astro';
import LevelTag from '../../components/LevelTag.astro';
import { getModuleBySlug, modules, formatCapacity } from '../../data/modules';
import { pricingTiers, pricingInfo, paymentOptions } from '../../data/pricing';

export async function getStaticPaths() {
  return modules.map((module) => ({
    params: { slug: module.slug },
  }));
}

const { slug } = Astro.params;
const module = getModuleBySlug(slug!);

if (!module) {
  return Astro.redirect('/modules');
}
---

<BaseLayout
  title={`${module.title} | CDMC`}
  description={module.shortDescription}
>
  <!-- Hero du module -->
  <Section id="module-hero" className={`bg-gradient-to-b from-warm-100 to-warm-50 ${module.comingSoon ? 'opacity-75' : ''}`}>
    <div class="max-w-3xl mx-auto text-center">
      <div class="flex items-center justify-center gap-4 mb-4 flex-wrap">
        <h1 class={`text-4xl md:text-5xl font-bold ${module.comingSoon ? 'text-warm-500' : 'text-warm-800'}`}>
          {module.title}
        </h1>
        <div class="flex items-center gap-2">
          {module.comingSoon && (
            <span class="px-3 py-1 text-sm font-medium bg-warm-200 text-warm-600 rounded">
              Prochainement
            </span>
          )}
          {module.almostFull && (
            <span class="px-3 py-1 text-sm font-medium bg-terracotta-100 text-terracotta-700 rounded">
              Bient√¥t complet
            </span>
          )}
          <LevelTag level={module.niveau} />
        </div>
      </div>
      {module.comingSoon && (
        <div class="bg-warm-100 rounded-lg p-4 mb-4 border-l-4 border-warm-300">
          <p class="text-warm-700 font-medium mb-2">
            Ce module est actuellement en pause et sera disponible prochainement.
          </p>
          <p class="text-warm-700 text-sm">
            Tu peux <strong>t'y pr√©-inscrire</strong> d√®s maintenant. 
            Dans le formulaire, utilise la section "Commentaire" pour me situer sur ton projet et tes attentes.
          </p>
        </div>
      )}
      {module.almostFull && (
        <div class="bg-terracotta-50 rounded-lg p-4 mb-4 border-l-4 border-terracotta-400">
          <p class="text-terracotta-800 font-medium">
            ‚ö†Ô∏è Ce module est bient√¥t complet. Inscris-toi rapidement pour garantir ta place !
          </p>
        </div>
      )}
      <p class={`text-xl mb-6 ${module.comingSoon ? 'text-warm-500' : 'text-warm-700'}`}>
        {module.fullDescription}
      </p>
    </div>
  </Section>

  <!-- Pr√©requis -->
  <Section id="prerequis" title="Pr√©requis et niveau requis">
    <div class="max-w-3xl mx-auto">
      {module.niveau === 1 && (
        <div class="bg-warm-50 border-l-4 border-terracotta-400 rounded-lg p-6">
          <div class="flex items-start gap-3 mb-3">
            <LevelTag level={1} />
            <h3 class="text-xl font-semibold text-warm-800">
              Aucun pr√©requis n√©cessaire
            </h3>
          </div>
          <p class="text-warm-700 mb-3">
            Ce module est accessible √† toutes et tous, m√™me si tu n'as jamais touch√© un instrument 
            ou √©tudi√© la musique. On part de z√©ro, dans une ambiance bienveillante o√π chaque question 
            est la bienvenue. L'important, c'est ta curiosit√© et ton envie d'apprendre, pas tes connaissances pr√©alables.
          </p>
          <p class="text-warm-700 text-sm italic">
            Tu peux venir avec tes doutes, tes questions, et m√™me l'impression de ne rien conna√Ætre. 
            C'est exactement pour √ßa qu'on est l√†.
          </p>
          <p class="text-warm-700 text-sm mt-3">
            Si tu as des questions ou besoin de plus d'informations pour te situer, 
            <a href="/contact#contact-form" class="text-terracotta-600 underline hover:text-terracotta-700 font-medium">n'h√©site pas √† me contacter</a>. 
            J'ai des outils √† disposition pour t'aider √† te situer et on peut le faire ensemble.
          </p>
        </div>
      )}
      {module.niveau === 2 && (
        <div class="bg-warm-50 border-l-4 border-terracotta-500 rounded-lg p-6">
          <div class="flex items-start gap-3 mb-3">
            <LevelTag level={2} />
            <h3 class="text-xl font-semibold text-warm-800">
              Quelques bases recommand√©es
            </h3>
          </div>
          <p class="text-warm-700 mb-3">
            Ce module est accessible si tu as d√©j√† quelques notions de base en musique. 
            Pas besoin d'√™tre un¬∑e expert¬∑e, mais avoir d√©j√† explor√© un peu la musique (notes, accords de base, 
            pratique d'un instrument) te permettra de mieux profiter du contenu.
          </p>
          <p class="text-warm-700 text-sm italic mb-3">
            Si tu n'es pas s√ªr¬∑e d'avoir le niveau requis, je te recommande de commencer par le module 
            <a href="/modules/theorie-debutant" class="text-terracotta-600 underline hover:text-terracotta-700 font-medium">Th√©orie D√©butant</a> pour poser de bonnes bases avant de venir ici.
          </p>
          <p class="text-warm-700 text-sm">
            Si tu as besoin de plus d'informations pour te situer, 
            <a href="/contact#contact-form" class="text-terracotta-600 underline hover:text-terracotta-700 font-medium">n'h√©site pas √† me contacter</a>. 
            J'ai des outils √† disposition pour t'aider √† te situer et on peut le faire ensemble.
          </p>
        </div>
      )}
      {module.niveau === 3 && (
        <div class="bg-warm-50 border-l-4 border-terracotta-600 rounded-lg p-6">
          <div class="flex items-start gap-3 mb-3">
            <LevelTag level={3} />
            <h3 class="text-xl font-semibold text-warm-800">
              Pr√©requis n√©cessaires
            </h3>
          </div>
          <p class="text-warm-700 mb-3">
            Ce module n√©cessite d'avoir <strong>ma√Ætris√© les concepts du module Interm√©diaire</strong> ou d'avoir 
            des connaissances √©quivalentes. Ce n'est pas un module pour tout le monde, mais si tu as les bases 
            n√©cessaires, tu y trouveras une exploration approfondie et passionnante de sujets sp√©cifiques.
          </p>
          <p class="text-warm-700 mb-3">
            <strong>Pr√©requis obligatoires :</strong>
          </p>
          <ul class="list-disc list-inside text-warm-700 mb-3 space-y-1 ml-4">
            <li>Compr√©hension des fonctions harmoniques (tonique, sous-dominante, dominante)</li>
            <li>Connaissance des cadences principales et de leurs usages</li>
            <li>Savoir ce que sont les accords enrichis (7e, 9e, 11e, 13e) - sans forc√©ment conna√Ætre toutes les possibilit√©s</li>
            <li>Capacit√© √† analyser des progressions harmoniques simples</li>
            <li>Pratique r√©guli√®re et approfondie de la th√©orie musicale</li>
          </ul>
          <p class="text-warm-700 text-sm italic mb-3">
            Si tu n'es pas s√ªr¬∑e d'avoir le niveau requis, je te recommande fortement de suivre le module 
            <a href="/modules/theorie-intermediaire" class="text-terracotta-600 underline hover:text-terracotta-700 font-medium">Th√©orie Interm√©diaire</a> avant de venir ici. 
            Ce module avanc√© suppose que ces concepts sont d√©j√† acquis et ma√Ætris√©s.
          </p>
          <p class="text-warm-700 text-sm">
            Si tu as besoin de plus d'informations pour te situer, 
            <a href="/contact#contact-form" class="text-terracotta-600 underline hover:text-terracotta-700 font-medium">n'h√©site pas √† me contacter</a>. 
            J'ai des outils √† disposition pour t'aider √† te situer et on peut le faire ensemble.
          </p>
        </div>
      )}
    </div>
  </Section>

  <!-- √Ä qui s'adresse ce module -->
  <Section id="target" title="√Ä qui s'adresse ce module ?" className="bg-warm-50">
    <div class="max-w-3xl mx-auto">
      <p class="text-lg text-warm-700">
        {module.targetAudience}
      </p>
    </div>
  </Section>

  <!-- Ce qu'on y fait -->
  <Section id="content" title="Ce qu'on y fait" className="bg-warm-50">
    <div class="max-w-3xl mx-auto">
      <ul class="space-y-3">
        {module.whatYouDo.map((item) => (
          <li class="flex items-start">
            <span class="text-terracotta-600 mr-3 mt-1">‚Ä¢</span>
            <span class="text-warm-700 text-lg">{item}</span>
          </li>
        ))}
      </ul>
    </div>
  </Section>

  <!-- Points forts -->
  <Section id="highlights" title="Points forts p√©dagogiques">
    <div class="max-w-3xl mx-auto">
      <ul class="space-y-3">
        {module.highlights.map((highlight) => (
          <li class="flex items-start">
            <span class="text-terracotta-600 mr-3 mt-1">‚úì</span>
            <span class="text-warm-700 text-lg">{highlight}</span>
          </li>
        ))}
      </ul>
    </div>
  </Section>

  <!-- Planning et dates -->
  <Section id="schedule" title="Planning et dates 2026" className="bg-warm-50">
    <div class="max-w-3xl mx-auto space-y-6">
      <div>
        <h3 class="text-xl font-semibold text-warm-800 mb-2">
          Rythme des s√©ances
        </h3>
        <p class="text-warm-700">
          <strong>{module.schedule.day}</strong> de la <strong>
            {module.schedule.week === 'Semaine Th√©orie' ? (
              <a href="/modules#organisation-mensuelle" class="text-warm-800 hover:text-terracotta-600 underline">Semaine Th√©orie</a>
            ) : module.schedule.week === 'Semaine Pratique' ? (
              <a href="/modules#organisation-mensuelle" class="text-warm-800 hover:text-terracotta-600 underline">Semaine Pratique</a>
            ) : (
              module.schedule.week
            )}
          </strong> de chaque mois.
          Chaque s√©ance dure <strong>2h30</strong>.
        </p>
      </div>

      <div>
        <h3 class="text-xl font-semibold text-warm-800 mb-4">
          Dates du cycle (janvier √† mai 2026)
        </h3>
        <div class="bg-white rounded-lg shadow-md p-6 border border-warm-200">
          <ul class="space-y-2">
            {module.dates.map((date) => (
              <li class="flex items-center text-warm-700">
                <span class="text-terracotta-600 mr-3">üìÖ</span>
                <span class="text-lg">{date}</span>
              </li>
            ))}
          </ul>
        </div>
      </div>

      <div class="bg-warm-100 rounded-lg p-6">
        <p class="text-warm-800 mb-2">
          <strong>Lieu :</strong> {pricingInfo.location}
        </p>
        <p class="text-warm-700">
          <strong>Capacit√© :</strong> {formatCapacity(module.capacity)} par module
        </p>
      </div>
    </div>
  </Section>

  <!-- Tarifs -->
  <Section id="pricing" title="Tarifs">
    <div class="max-w-3xl mx-auto">
      <p class="text-lg text-warm-700 mb-4">
        Les tarifs sont d√©gressifs selon le nombre de modules choisis. 
        <strong>Engagement sur 5 mois</strong> pour garantir la coh√©sion du groupe 
        et une progression r√©guli√®re.
      </p>
      <div class="bg-warm-100 rounded-lg p-6 mb-6">
        <p class="text-warm-800 mb-2">
          <strong>Exemple :</strong> Si tu choisis uniquement ce module, 
          c'est <strong class="text-terracotta-700 text-xl">{Math.round(pricingTiers[0].cyclePrice / 5)} ‚Ç¨/mois</strong> 
          (soit {pricingTiers[0].cyclePrice} ‚Ç¨ pour les 5 mois).
        </p>
        <p class="text-warm-700 text-sm mb-3">
          Si tu combines plusieurs modules, les tarifs sont d√©gressifs. 
          Voir la <a href="/#tarifs" class="text-terracotta-600 underline hover:text-terracotta-700">page d'accueil</a> pour le d√©tail complet.
        </p>
        <p class="text-warm-700 text-sm">
          Plusieurs modalit√©s de paiement sont propos√©es (en 1 fois, 2 fois ou 3 fois) 
          pour cr√©er de l'engagement et garantir ta place dans le groupe.
        </p>
      </div>
    </div>
  </Section>

  <!-- CTA inscription -->
  <Section id="cta" className="bg-gradient-to-b from-terracotta-50 to-warm-100">
    <div class="text-center max-w-2xl mx-auto">
      {module.comingSoon ? (
        <>
          <h2 class="text-3xl font-bold text-warm-800 mb-4">
            Ce module t'int√©resse ?
          </h2>
          <div class="bg-white rounded-lg p-6 mb-6 border border-warm-200 text-left">
            <p class="text-lg text-warm-700 mb-4">
              Ce module est actuellement en pause, mais tu peux <strong>t'y pr√©-inscrire</strong> d√®s maintenant 
              pour √™tre inform√©¬∑e d√®s qu'il sera disponible.
            </p>
            <p class="text-warm-700 mb-4">
              Dans le formulaire de pr√©-inscription, tu pourras <strong>mettre un message dans la section "Commentaire"</strong> 
              pour me situer sur ton projet, tes envies, tes questions ou tes attentes concernant ce module. 
              Cela m'aidera √† mieux comprendre tes besoins et √† te recontacter au bon moment.
            </p>
            <p class="text-warm-600 text-sm italic">
              üí° M√™me si le module n'est pas encore actif, ta pr√©-inscription me permet de voir l'int√©r√™t 
              et de te tenir inform√©¬∑e de son ouverture prochaine.
            </p>
          </div>
          <CTA 
            href={`/contact?module=${module.id}#inscription-form`} 
            text={`Je me pr√©-inscris √† ${module.title}`} 
          />
        </>
      ) : (
        <>
          <h2 class="text-3xl font-bold text-warm-800 mb-4">
            Int√©ress√©¬∑e par ce module ?
          </h2>
          <p class="text-lg text-warm-700 mb-8">
            Inscris-toi ou pose-moi tes questions via le formulaire de contact.
          </p>
          <CTA 
            href={`/contact?module=${module.id}#inscription-form`} 
            text={`Je m'inscris √† ${module.title}`} 
          />
        </>
      )}
    </div>
  </Section>
</BaseLayout>

