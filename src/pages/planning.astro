---
import BaseLayout from '../layouts/BaseLayout.astro';
import Section from '../components/Section.astro';
import CTA from '../components/CTA.astro';
import { modules } from '../data/modules';
import { pricingInfo } from '../data/pricing';

// Pr√©parer les donn√©es pour le tableau r√©capitulatif des dates
const niveauLabels: Record<1 | 2 | 3, string> = {
  1: 'D√©butant',
  2: 'Interm√©diaire',
  3: 'Avanc√©',
};

const allDates: Array<{
  date: string;
  week: string;
  course: string;
  day: string;
  slug: string;
}> = [];

modules.forEach((module) => {
  const niveauLabel = niveauLabels[module.niveau];
  // Afficher le niveau seulement pour les modules de th√©orie (qui ont plusieurs niveaux)
  // Pour les modules pratiques, on affiche juste le titre
  const isTheoryModule = module.title.includes('Th√©orie');
  const courseLabel = isTheoryModule 
    ? `${module.title} (${niveauLabel})`
    : module.title;
  
  module.dates.forEach((date) => {
    allDates.push({
      date,
      week: module.schedule.week,
      course: courseLabel,
      day: module.schedule.day,
      slug: module.slug,
    });
  });
});

// Trier par date (approximation simple pour l'affichage)
const monthOrder: Record<string, number> = {
  'janvier': 1,
  'f√©vrier': 2,
  'mars': 3,
  'avril': 4,
  'mai': 5,
};

allDates.sort((a, b) => {
  const aMonth = Object.keys(monthOrder).find(m => a.date.includes(m)) || '';
  const bMonth = Object.keys(monthOrder).find(m => b.date.includes(m)) || '';
  const aMonthNum = monthOrder[aMonth] || 0;
  const bMonthNum = monthOrder[bMonth] || 0;
  
  if (aMonthNum !== bMonthNum) {
    return aMonthNum - bMonthNum;
  }
  
  // Si m√™me mois, trier par jour
  const aDay = parseInt(a.date.match(/^\d+/)?.[0] || '0');
  const bDay = parseInt(b.date.match(/^\d+/)?.[0] || '0');
  return aDay - bDay;
});
---

<BaseLayout
  title="Planning et organisation | CDMC"
  description="D√©couvre l'organisation des cours CDMC : planning mensuel, dates des s√©ances, organisation des semaines th√©orie et pratique. Cycle de 5 mois de janvier √† mai 2026."
>
  <!-- Hero Section -->
  <Section id="planning-hero" className="bg-gradient-to-b from-warm-100 to-warm-50">
    <div class="max-w-3xl mx-auto text-center">
      <h1 class="text-4xl md:text-5xl font-bold text-warm-800 mb-4">
        Planning et organisation
      </h1>
      <p class="text-xl text-warm-700 mb-6">
        Tout ce qu'il faut savoir sur le rythme, les dates et l'organisation des cours CDMC
      </p>
    </div>
  </Section>

  <!-- Rythme et dur√©e -->
  <Section id="rythme" title="Rythme et dur√©e">
    <div class="max-w-3xl mx-auto space-y-6">
      <div class="bg-warm-100 rounded-lg p-6 space-y-4">
        <div>
          <h3 class="text-xl font-semibold text-warm-800 mb-3">
            Format des s√©ances
          </h3>
          <ul class="space-y-2 text-warm-700">
            <li class="flex items-start">
              <span class="text-terracotta-600 mr-2">‚Ä¢</span>
              <span><strong>Une s√©ance par mois</strong>, de <strong>2h30</strong></span>
            </li>
            <li class="flex items-start">
              <span class="text-terracotta-600 mr-2">‚Ä¢</span>
              <span>Cycle de <strong>5 mois</strong> (janvier √† mai 2026)</span>
            </li>
            <li class="flex items-start">
              <span class="text-terracotta-600 mr-2">‚Ä¢</span>
              <span>Entre <strong>4 et 9 participant¬∑es</strong> par module pour une ambiance intime</span>
            </li>
          </ul>
        </div>

        <div class="border-t border-warm-200 pt-4">
          <h3 class="text-xl font-semibold text-warm-800 mb-3">
            Engagement
          </h3>
          <p class="text-warm-700">
            L'engagement se fait sur <strong>5 mois complets</strong> pour garantir la coh√©sion du groupe 
            et une progression r√©guli√®re. Chaque s√©ance est importante dans le parcours d'apprentissage.
          </p>
        </div>
      </div>
    </div>
  </Section>

  <!-- Organisation mensuelle -->
  <Section id="organisation-mensuelle" title="Organisation mensuelle" className="bg-warm-50">
    <div class="max-w-3xl mx-auto space-y-6">
      <div>
        <p class="text-lg text-warm-700 mb-6">
          Les s√©ances ont lieu dans <strong>les deux derni√®res semaines de chaque mois</strong>, 
          organis√©es en deux types de semaines distinctes :
        </p>

        <div class="bg-white rounded-lg shadow-md p-6 border border-warm-200 space-y-6 mb-6">
          <div>
            <h3 class="text-xl font-semibold text-warm-800 mb-3">
              Semaine Th√©orie (avant-derni√®re semaine du mois)
            </h3>
            <p class="text-warm-700 mb-3">
              Cette semaine est d√©di√©e aux modules th√©oriques. Trois modules sont propos√©s :
            </p>
            <ul class="space-y-2 text-warm-700 ml-4">
              <li>‚Ä¢ <strong>Mardi</strong> : Th√©orie D√©butant</li>
              <li>‚Ä¢ <strong>Mercredi</strong> : Th√©orie Interm√©diaire</li>
              <li>‚Ä¢ <strong>Jeudi</strong> : Th√©orie Avanc√©e</li>
            </ul>
            <p class="text-warm-600 text-sm mt-3 italic">
              Ces modules permettent de comprendre les fondements de la musique, les accords, 
              les fonctions harmoniques, et d'approfondir ta compr√©hension th√©orique.
            </p>
          </div>

          <div class="border-t border-warm-200 pt-6">
            <h3 class="text-xl font-semibold text-warm-800 mb-3">
              Semaine Pratique (derni√®re semaine du mois)
            </h3>
            <p class="text-warm-700 mb-3">
              Cette semaine est d√©di√©e aux modules pratiques. Trois modules sont propos√©s :
            </p>
            <ul class="space-y-2 text-warm-700 ml-4">
              <li>‚Ä¢ <strong>Mardi</strong> : Piano</li>
              <li>‚Ä¢ <strong>Mercredi</strong> : MAO (Musique Assist√©e par Ordinateur)</li>
              <li>‚Ä¢ <strong>Jeudi</strong> : Rythmique</li>
            </ul>
            <p class="text-warm-600 text-sm mt-3 italic">
              Ces modules permettent de mettre en pratique ce que tu apprends, de jouer, 
              de cr√©er et de d√©velopper tes comp√©tences techniques.
            </p>
          </div>
        </div>

        <div class="bg-warm-100 rounded-lg p-6 border-l-4 border-terracotta-500">
          <p class="text-warm-800 font-medium mb-2">
            üí° Pourquoi cette organisation ?
          </p>
          <p class="text-warm-700 text-sm">
            Cette d√©coupe permet de s√©parer clairement la th√©orie et la pratique, 
            tout en offrant une flexibilit√© pour combiner plusieurs modules selon tes envies et tes besoins. 
            Tu peux suivre uniquement des modules th√©oriques, uniquement des modules pratiques, 
            ou combiner les deux pour une approche compl√®te.
          </p>
        </div>
      </div>
    </div>
  </Section>

  <!-- Tableau r√©capitulatif des dates -->
  <Section id="dates-recap" title="Vue d'ensemble des dates">
    <div class="max-w-4xl mx-auto space-y-6">
      <div>
        <p class="text-lg text-warm-700 mb-6">
          Voici le planning complet de toutes les s√©ances pour le cycle de janvier √† mai 2026. 
          Les dates sont organis√©es chronologiquement pour te donner une vue d'ensemble.
        </p>

        <div class="overflow-x-auto">
          <table class="w-full border-collapse bg-white rounded-lg shadow-md">
            <thead>
              <tr class="bg-warm-200">
                <th class="border border-warm-300 px-4 py-3 text-left font-semibold text-warm-800">
                  Semaine
                </th>
                <th class="border border-warm-300 px-4 py-3 text-left font-semibold text-warm-800">
                  Jour
                </th>
                <th class="border border-warm-300 px-4 py-3 text-left font-semibold text-warm-800">
                  Cours et niveau
                </th>
                <th class="border border-warm-300 px-4 py-3 text-left font-semibold text-warm-800">
                  Date
                </th>
              </tr>
            </thead>
            <tbody>
              {allDates.map((item, index) => (
                <tr class={index % 2 === 0 ? 'bg-white' : 'bg-warm-50'}>
                  <td class="border border-warm-300 px-4 py-3 text-warm-700">
                    <span class="font-medium">{item.week}</span>
                  </td>
                  <td class="border border-warm-300 px-4 py-3 text-warm-700">
                    {item.day}
                  </td>
                  <td class="border border-warm-300 px-4 py-3 text-warm-700">
                    <a href={`/modules/${item.slug}`} class="text-terracotta-600 hover:text-terracotta-700 underline font-medium">
                      {item.course}
                    </a>
                  </td>
                  <td class="border border-warm-300 px-4 py-3 text-warm-700 font-medium">
                    {item.date} 2026
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>

        <div class="bg-warm-100 rounded-lg p-6 mt-6">
          <p class="text-warm-800 font-medium mb-2">
            üìÖ Note importante
          </p>
          <p class="text-warm-700 text-sm">
            Toutes les s√©ances durent <strong>2h30</strong>. Les dates peuvent √™tre ajust√©es en cas de n√©cessit√©, 
            mais le planning g√©n√©ral reste stable sur les deux derni√®res semaines de chaque mois. 
            Si tu as des questions sur une date sp√©cifique, n'h√©site pas √† me contacter.
          </p>
        </div>
      </div>
    </div>
  </Section>

  <!-- Lieu -->
  <Section id="lieu" title="Lieu" className="bg-warm-50">
    <div class="max-w-3xl mx-auto">
      <div class="bg-white rounded-lg shadow-md p-6 border border-warm-200">
        <p class="text-warm-700 mb-4">
          Les cours se d√©roulent dans un <strong>grand salon am√©nag√©</strong>, √† Toulouse. 
          La capacit√© varie selon les modules (de 2 √† 9 participant¬∑es) pour garantir une ambiance intime 
          et un suivi personnalis√©.
        </p>
        <p class="text-warm-700">
          <strong>Lieu :</strong> {pricingInfo.location}
        </p>
      </div>
    </div>
  </Section>

  <!-- CTA -->
  <Section id="cta" className="bg-gradient-to-b from-terracotta-50 to-warm-100">
    <div class="text-center max-w-2xl mx-auto">
      <h2 class="text-3xl font-bold text-warm-800 mb-4">
        Pr√™t¬∑e √† t'inscrire ?
      </h2>
      <p class="text-lg text-warm-700 mb-8">
        Maintenant que tu connais l'organisation, d√©couvre les modules en d√©tail ou inscris-toi directement.
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <CTA href="/modules" text="D√©couvrir les modules" variant="secondary" />
        <CTA href="/contact" text="Je m'inscris" />
      </div>
    </div>
  </Section>
</BaseLayout>

