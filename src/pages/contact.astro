---
import BaseLayout from '../layouts/BaseLayout.astro';
import Section from '../components/Section.astro';
import ContactForm from '../components/ContactForm.astro';

const url = Astro.url;
const moduleParam = url.searchParams.get('module');
---

<BaseLayout
  title="Contact & Inscription | CDMC"
  description="Contacte CDMC pour en savoir plus ou demander des informations sur les cours de musique à Toulouse. Formulaire de contact et demande d'informations."
>
  <Section id="contact-hero" className="bg-gradient-to-b from-warm-100 dark:from-warm-800 to-warm-50 dark:to-warm-900">
    <div class="max-w-3xl mx-auto text-center">
      <h1 class="text-4xl md:text-5xl font-bold text-warm-800 dark:text-warm-100 mb-6">
        Contact & Inscription
      </h1>
      <p class="text-xl text-warm-700 dark:text-warm-200">
        Tu veux en savoir plus, t'inscrire, poser une question ? 
        Utilise l'un des formulaires ci-dessous.
      </p>
    </div>
  </Section>

  <Section id="inscription-form" title="Demande d'informations">
    <div class="max-w-2xl mx-auto">
      <p class="text-warm-700 dark:text-warm-200 mb-6">
        Tu veux en savoir plus sur un ou plusieurs modules ? Remplis ce formulaire de demande d'informations. 
        Je te recontacterai rapidement pour répondre à tes questions et discuter de ton projet.
      </p>
      {moduleParam && (
        <div class="bg-terracotta-50 dark:bg-terracotta-900 border border-terracotta-200 dark:border-terracotta-700 rounded-lg p-4 mb-6">
          <p class="text-terracotta-800 dark:text-terracotta-200">
            <strong>Module présélectionné :</strong> Le module "{moduleParam}" est présélectionné ci-dessous. 
            Tu peux en choisir d'autres si tu veux.
          </p>
        </div>
      )}
      <ContactForm type="inscription" preselectedModule={moduleParam || undefined} />
      <script is:inline>
        // Pré-cocher la checkbox du module sélectionné depuis l'URL
        (function() {
          const urlParams = new URLSearchParams(window.location.search);
          const moduleId = urlParams.get('module');
          
          if (!moduleId) return;
          
          function checkModule() {
            const checkbox = document.querySelector(`input[name="modules"][value="${moduleId}"]`);
            if (checkbox && !checkbox.checked) {
              checkbox.checked = true;
              checkbox.dispatchEvent(new Event('change', { bubbles: true }));
            }
          }
          
          // Essayer plusieurs fois avec des délais pour s'assurer que le formulaire est rendu
          [0, 100, 300, 500].forEach(delay => {
            setTimeout(checkModule, delay);
          });
          
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
              setTimeout(checkModule, 100);
            });
          }
        })();
      </script>
    </div>
  </Section>

  <Section id="contact-form" title="Formulaire de contact" className="bg-warm-50 dark:bg-warm-900">
    <div class="max-w-2xl mx-auto">
      <p class="text-warm-700 dark:text-warm-200 mb-6">
        Pour toute question générale, demande d'information, ou simplement pour discuter, 
        utilise ce formulaire.
      </p>
      <ContactForm type="contact" />
    </div>
  </Section>

  <Section id="infos-complementaires">
    <div class="max-w-3xl mx-auto">
      <h2 class="text-2xl font-semibold text-warm-800 dark:text-warm-100 mb-4">
        Informations complémentaires
      </h2>
      <div class="space-y-4 text-warm-700 dark:text-warm-200">
        <p>
          <strong>Réponse rapide :</strong> Je réponds généralement sous 24-48h à tous les messages.
        </p>
        <p>
          <strong>Rejoindre le groupe :</strong> Un groupe est constitué dès le début du cycle (janvier à mai 2026), 
          et une fois lancé·e, c'est bien de rester sur la suite pour une progression continue. 
          <strong>Tu peux aussi rejoindre en cours de route sans souci</strong> – on s'adapte à ta situation 
          et on te remet à niveau si besoin. Plusieurs modalités de paiement sont proposées (en 1 fois, 2 fois ou 3 fois).
        </p>
        <p>
          <strong>Places limitées :</strong> Chaque module accueille entre 4 et 9 participant·es maximum. 
          N'hésite pas à demander des informations si tu es intéressé·e, nous pourrons discuter sans engagement.
        </p>
      </div>
    </div>
  </Section>
</BaseLayout>

